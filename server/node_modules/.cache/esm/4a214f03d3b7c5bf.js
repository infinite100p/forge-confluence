let fetch;_d3b‍.w("node-fetch",[["default",["fetch"],function(v){fetch=v}]]);// import { createRequire } from 'module'
// const require = createRequire(import.meta.url);

const express = require('express');
const app = express(); 
const port = process.env.PORT || 5000; 

// const fetch = require('node-fetch');
require('dotenv').config();


// run and listen to server
app.listen(port, () => console.log(`Listening on port ${port}`)); 

// create a GET route
app.get('/express_backend', (req, res) => { 
  res.send({ express: 'Connected' }); 
});

function getCalendlyUser() {
  let url = 'https://api.calendly.com/users/me';

  let options = {
    method: 'GET',
    headers: {'Content-Type': 'application/json', Authorization: `Bearer ${process.env.CALENDLY_API_KEY}`}
  };

  fetch(url, options)
    .then(res => res.json())
    .then(json => _d3b‍.g.console.log(json))
    .catch(err => _d3b‍.g.console.error('error:' + err));
}

// 404 Error - Resource Not Found
// can't proceed
function getCalendlyEvents() {
  let url = `https://api.calendly.com/scheduled_events/user/${process.env.CALENDLY_USER}`;
  // let url = `https://api.calendly.com/scheduled_events/organization/${process.env.CALENDLY_ORGANIZATION}`;

  let options = {
    method: 'GET',
    qs: {status: 'active'},
    headers: {'Content-Type': 'application/json', Authorization: `Bearer ${process.env.CALENDLY_API_KEY}`}
  };

  fetch(url, options)
    .then(res => res.json())
    .then(json => _d3b‍.g.console.log(json))
    .catch(err => _d3b‍.g.console.error('error:' + err));
}
getCalendlyUser();
getCalendlyEvents();

// fetch("https://api.calendly.com/scheduled_events?status=active?user=codegeist-2021" 
//   // + new URLSearchParams({
//   //   organization: 'codegeist-2021'
//   // })
//   , {
//   "method": "GET",
//   "headers": {
//     "Content-Type": "application/json",
//     "Authorization": `Bearer ${CALENDLY_API_KEY}`
//   }
// })
// .then(response => {
//   console.log(response);
// })
// .catch(err => {
//   console.error(err);
// });

// 404 Error - Resource Not Found
// can't proceed
function getForgeUserProfile() {
  fetch(`https://api.atlassian.com/users/${FORGE_ACCOUNT_ID}/manage/profile`, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${process.env.FORGE_API_KEY}`,
      'Accept': 'application/json'
    }
  })
    .then(response => {
      console.log(
        `Get Profile Response: ${response.status} ${response.statusText}`
      );
      return response.text();
    })
    .then(text => _d3b‍.g.console.log(text))
    .catch(err => _d3b‍.g.console.error(err));
}

getForgeUserProfile();